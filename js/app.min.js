let playersIdentity=["Pas de joeur","Human"],userActifList=[],indiceKeyUserActiflist=0,userTypeA=1,userTypeB=1,userTypeC=1,userTypeD=1,userActif,diceValue,pawnSelected,songStep=new Audio("songs/step.mp3");var dead_sound=new Audio("assets/audio/dead.mp3"),inout_sound=new Audio("assets/audio/inout.mp3"),dice_sound=new Audio("songs/dice.mp3"),winnerSound=new Audio("assets/audio/winner.mp3");let safePlace=[0,1,2,3],isSwitchToNextUser=!0,buttonActions,divElementUserActif,lastDiceValue=0,showDiceFaceTemporary;const PAWN_SIZE=4,ROAD_SIZE=51;function dice(){diceValue=getRandomInt(6),dice_sound.play(),document.getElementById(userActif.buttonAction).innerText=diceValue,checkIfPawnCanMoveAndMakeItToVisible(diceValue)}const checkIfPawnCanMoveAndMakeItToVisible=e=>{let t=userActif.pawns,s=!1;for(let n of(1==e&&(isSwitchToNextUser=!1),t))(1==e||"free"==n.status)&&n.currentPosition+e<n.road.length+1&&(setPawnVisible(n),s=!0);s||switchToNextUser()},setPawnVisible=e=>{document.getElementById(e.idAvatar).classList.add("canMove"),document.getElementById(e.idAvatar).removeAttribute("disabled")},resetAllPawnsVisibility=()=>{for(let e of document.getElementsByClassName("pawn"))e.classList.remove("canMove"),e.setAttribute("disabled",!0)};function validateSelection(){1==userTypeA||2==userTypeA?(userA.isActif=!0,2==userTypeA&&(userA.isBot=!0)):document.getElementById("button-user-one").classList.add("hidden"),1==userTypeB||2==userTypeB?(userB.isActif=!0,2==userTypeB&&(userB.isBot=!0)):document.getElementById("button-user-two").classList.add("hidden"),1==userTypeC||2==userTypeC?(userC.isActif=!0,2==userTypeC&&(userC.isBot=!0)):document.getElementById("button-user-tree").classList.add("hidden"),1==userTypeD||2==userTypeD?(userD.isActif=!0,2==userTypeA&&(userA.isBot=!0)):document.getElementById("button-user-four").classList.add("hidden"),initPlayer(()=>{document.getElementsByClassName("container-control")[0].classList.add("hidden"),divElementUserActif=document.getElementById(userActif.buttonAction).classList.add("active")})}function initPlayer(e){if(userA.isActif&&(placePawnsForUserActifInHome(userA),userActifList.push(userA)),userB.isActif&&(placePawnsForUserActifInHome(userB),userActifList.push(userB)),userC.isActif&&(placePawnsForUserActifInHome(userC),userActifList.push(userC)),userD.isActif&&(placePawnsForUserActifInHome(userD),userActifList.push(userD)),userActifList.length>=1){for(let t of(userActifList[indiceKeyUserActiflist].isCurrentUser=!0,resetAllPawnsVisibility(),setCurentUserActif(userActifList[indiceKeyUserActiflist]),userActif=userActifList[indiceKeyUserActiflist],userActifList))for(let s of t.pawns)document.getElementById(s.idAvatar).addEventListener("click",e=>{pawnSelected=getPawnByDivElement(s.idAvatar),resetAllPawnsVisibility(),stepsMove(pawnSelected,diceValue)});e()}else alert("Selectionner deux jusqu'\xe0 quatre joeurs")}function getPawnByDivElement(e){for(let t of userActif.pawns)if(t.idAvatar===e)return t}function updateUser(e,t=[],s=!1,n=!1,r="home",a=0,o=!1){if(e.isActif){let l;for(let c of t)(l=e.pawns[c-1]).status=r,l.currentPosition=a,0==a&&document.getElementById(l.idAvatar).remove()}e.isActif=s,e.isBot=n,e.isCurrentUser=o}async function stepsMove(e,t){let s=e.currentPosition,n=document.getElementById(e.idAvatar),r;e.status="free";for(let a=0;a<t;a++)if(e.road.length>=s+t)a+s<e.road.length&&(r=e.road[a+s],document.getElementsByClassName("step")[r].append(n),e.currentPosition=a+s,e.currentPosition+=1,songStep.play(),await sleep(500));else break;for(let o of userActifList)if(userActif!==o){for(let l of userActif.pawns)for(let c of o.pawns)if(l.road[l.currentPosition]==c.road[c.currentPosition]){if(!safePlace.includes(c.road[c.currentPosition-1])){for(;0!=c.currentPosition;)document.getElementsByClassName("step")[c.road[c.currentPosition-1]].append(document.getElementById(c.idAvatar)),c.currentPosition-=1,await sleep(100);document.getElementById(o.homeId).append(document.getElementById(c.idAvatar)),isSwitchToNextUser=!1}c.status="home",dead_sound.play()}}resetAllPawnsVisibility(),setNumberOfJourneysTraveledPerCent(),isSwitchToNextUser?switchToNextUser():isSwitchToNextUser=!0}function setNumberOfJourneysTraveledPerCent(){let e=0;userActif.pawns.forEach(t=>{e=t.currentPosition+e,console.log("value",e)}),console.log(userActif),console.log("value total",e),console.log("value divise",Math.round(e/204*100)),document.getElementById(mapUserToColor(userActif)).innerText=Math.round(e/204*100)+"%"}function switchToNextUser(){++indiceKeyUserActiflist,userActifList.length-1<indiceKeyUserActiflist&&(indiceKeyUserActiflist=0),userActif=userActifList[indiceKeyUserActiflist],disableButtonElement(buttonActions=document.getElementsByClassName("action")),(divElementUserActif=document.getElementById(userActif.buttonAction)).disabled=!1,divElementUserActif.classList.add("active"),removePawnsUserDivElementToFront(),makePawnsUserDivElementToFront()}const makePawnsUserDivElementToFront=()=>{for(let e of userActif.pawns)document.getElementById(e.idAvatar).classList.add("zIndexMax")},removePawnsUserDivElementToFront=()=>{for(let e of document.getElementsByClassName("pawn"))e.classList.remove("zIndexMax")};function disableButtonElement(e){for(let t of buttonActions)t.setAttribute("disabled",!0),t.classList.remove("active")}function resetPosition(e){document.getElementById(e.idAvatart).remove(),e.currentPosition=0,e.status="hom",document.getElementById("home-user-One").innerHTML=userA.userAvatar}function sleep(e){return new Promise(t=>setTimeout(t,e))}function contentInitial(e,t){return`<div class="${e}">${t}</div>`}function getRandomInt(e=7){return min=Math.ceil(1),Math.floor(Math.random()*((e=Math.floor(e))-min))+min}function setCurentUserActif(e){let t=document.getElementById(e.buttonAction);document.getElementsByClassName("action")[0].setAttribute("disabled",""),document.getElementsByClassName("action")[1].setAttribute("disabled",""),document.getElementsByClassName("action")[2].setAttribute("disabled",""),document.getElementsByClassName("action")[3].setAttribute("disabled",""),t.removeAttribute("disabled","")}function placePawnsForUserActifInHome(e){for(i=0;i<4;i++)document.getElementById(e.homeId).insertAdjacentHTML("beforeend",e.pawns[i].userAvatar)}function leave(){window.location="/"}function selectPlayer(e){let t=playersIdentity.length-1;switch(e){case"userA":userTypeA=userTypeA<t?++userTypeA:0,document.getElementById("purple-player").innerText=playersIdentity[userTypeA];break;case"userB":userTypeB=userTypeB<t?++userTypeB:0,document.getElementById("green-player").innerText=playersIdentity[userTypeB];break;case"userC":userTypeC=userTypeC<t?++userTypeC:0,document.getElementById("pink-player").innerText=playersIdentity[userTypeC];break;case"userD":userTypeD=userTypeD<t?++userTypeD:0,document.getElementById("blue-player").innerText=playersIdentity[userTypeD]}}function viewInstru(){document.getElementById("modal").classList.remove("hidden")}const hideInstru=()=>{document.getElementById("modal").classList.add("hidden")};function mapUserToColor(e){switch(e.name){case"userA":return"yellow";case"userB":return"green";case"userC":return"red";case"userD":return"blue"}}